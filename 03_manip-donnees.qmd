# Manipulation de données (lecture/écriture) {.backgroundTitre}

## Introduction

-   Les deux parties suivantes [*Manipulation de données*]{.blue} introduisent les outils nécessaires aux traitements classiques à opérer sur une table de données.

-   A part pour la lecture et l’écriture de fichiers, les outils proposés relèvent des packages [**dplyr**]{.blue}) et [**tidyr**]{.blue}) : ils sont d’un usage plus aisé que les outils R de base et couvrent beaucoup des fonctionnalités les plus courantes.

**Objectif:** découvrir et utiliser les outils ([*packages*]{.blue}) nécessaires aux traitements classiques à opérer sur une table de données

-   Lecture et écriture de fichier : [**rio, readr, readxl**]{.blue}, etc.

-   Fonctionnalités les plus courantes de manipulation des données : [**dplyr**]{.blue} et [**tidyr**]{.blue}

## Lecture ou écriture de fichiers (façon simple)

Version courte: le package Rio permet avec une seule fonction d'importer
ou exporter quasiment tout type de fichier (.csv, .xlsx, .ods, .rds,
.sas7bdat, .parquet, etc.)

Syntaxe de base :

-   Import simple :
    `maTable <- import("V:/adresseMaTable/monFichierAImporter.csv")`

-   Export simple :
    `export(maTable,"V:/adresseMaTable/monFichierAExporter.xlsx")`

Rio est un package qui mobilise d'autres packages dédiés à certains
types de fichier, cf. aide de rio pour les connaître et spécifier
certains paramètres (ex: importer un seul onglet)

-   `MaTable <- import("V:/adresseMaTable/monFichierAImporter.xlsx", sheet="monOnglet")`
    (paramètres de `readxl::read_excel()`)

## Lecture de données (packages spécialisés)

Créer un data.frame :

-   data.frame()

-   importer des données de différents formats

| Format du fichier source                | Fonction \*                     |
|-----------------------------------------|---------------------------------|
| format de données « plats » (csv, txt…) | read_delim, read_csv, read_csv2 |
| RDS                                     | readRDS                         |
| XLSX, XLS                               | read.xlsx, read_excel           |
| ODS                                     | read_ods                        |
| SAS, SAV                                | read_sas, read_spss             |
| parquet                                 | read_parquet                    |

*\* Le détail des fonctions est dans les diapos masquées ou facilement trouvable en ligne ou dans l'onglet help*

## Lecture de données (packages spécialisés)

-   Format des colonnes

Pour la plupart des formats (csv, txt,…), il faut spécifier le type des colonnes :

`exploitations <- read_csv2("mes_donnees_exploitations.csv",`

`col_types = cols(.default = col_character(),`

`SAU = col_double(),`

`UGB = col_double()))`

Avantage du format RDS :

-   Conserve l'image exacte d'un objet : type de variable, encodage, etc.
-   Format plus léger

*C'est le format recommandé pour travailler sous R (enregistrement de tables de travail, de tables de mise à disposition, etc.)*

## Lecture de données (clic-bouton)

Rstudio dispose également d'un assistant d'import pour les fichiers textes (csv notamment), Excel voire SAS

![](img/clipboard-manip1.png){fig-align="center"}

## Lecture de données (clic-bouton)

![](img/clipboard-manip2.png){fig-align="center"}

## Lecture de données

Sur Cerise, on ne peut importer des données que si elles sont sauvegardées dans l'environnement Cerise. Pour importer des données enregistrées en local, il faut auparavant les enregistrer dans Cerise.

⇒ pour importer une table de l'ordinateur local sur Cerise, on utilise le bouton ***Télécharger***  (***Upload***) de l'onglet *Fichiers* (*Files*) en bas à droite de l'interface.

![](img/clipboard-manip3.png){fig-align="center"}

## Ecriture de données (packages spécialisés)

Enregistrer le **data.frame** résultat dans un fichier externe

| Format du fichier source | Fonction \* |
|----|----|
| format de données « plats » (csv, txt…) | write_delim, write_csv, write_csv2 *format recommandé pour l'utilisation dans d'autres logiciels que R* |
| RDS | SaveRDS *format recommandé pour l'utilisation dans R* |
| XLSX, XLS | write.xlsx |
| ODS | write_ods |
| SAS, SAV | **NON RECOMMANDE** |
| parquet | write_parquet |

*\* Le détail des fonctions est dans les diapos masquées ou facilement trouvable en ligne ou dans l'onglet help*
